{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container my-5 quiz-container">

    <!-- Header -->
    <div class="quiz-header mb-4">
        <h3>Quiz: <span class="subject-name">{{ subject.name }}</span></h3>
        <div class="progress-container">
            <div class="progress">
                <div class="progress-bar" role="progressbar"
                     style="width: {{ current_question|divisibleby:total_questions|floatformat:0 }}%;"
                     aria-valuenow="{{ current_question }}" aria-valuemin="0" aria-valuemax="{{ total_questions }}">
                </div>
            </div>
            <small class="text-muted d-block mt-1">
                Question {{ current_question }} of {{ total_questions }}
            </small>
        </div>
    </div>

    <!-- Question -->
    <div class="card shadow-sm mb-4">
        <div class="card-body">

            <h5 class="mb-3">{{ question.text_content }}</h5>

            <!-- Options -->
            <form method="POST" id="quizForm" novalidate>
                {% csrf_token %}

                <div class="list-group options-container">
                    {% for option in options %}
                        <label class="list-group-item d-flex align-items-center option
                            {% if highlight_wrong and option.id in wrong_option_ids %} wrong-option {% endif %}
                            {% if highlight_correct and option.is_correct %} correct-option {% endif %}
                        ">
                            <input type="radio" 
                                   name="answer" 
                                   value="{{ option.id }}"
                                   class="form-check-input me-2"
                                   {% if progress.selected_option and option.id == progress.selected_option.id %}
                                        checked
                                   {% endif %}
                            >
                            {{ option.text_content }}
                        </label>
                    {% endfor %}
                </div>

                <!-- Feedback -->
                {% if feedback %}
                    <div class="alert alert-{{ feedback.type }} mt-3" role="alert">
                        <i class="fas fa-{{ feedback.icon }}"></i>
                        <strong>{{ feedback.title }}</strong> - {{ feedback.message }}
                        {% if feedback.explanation %}
                            <hr>
                            <p class="mb-0">{{ feedback.explanation }}</p>
                        {% endif %}
                    </div>
                {% endif %}

                <!-- Hint -->
                {% if show_hint_option %}
                    <div class="hint-section mt-3 text-center">
                        <button type="button" class="btn btn-outline-info btn-sm" id="hint-btn">
                            <i class="fas fa-lightbulb"></i> Show Hint
                        </button>
                        <div class="hint-box mt-2" id="hint-box" style="display:none;">
                            <strong>Hint:</strong> {{ hint }}
                        </div>
                    </div>
                {% endif %}

                <!-- Buttons -->
                <div class="mt-4 d-flex justify-content-between">
                    <!-- Previous -->
                    {% if previous_question %}
                        <a href="{% url 'question_detail' subject.id previous_question.id %}"
                           class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Previous
                        </a>
                    {% endif %}

                    <!-- Submit / Next / Finish -->
                    {% if show_next and next_question %}
                        <a href="{% url 'question_detail' subject.id next_question.id %}" class="btn btn-success">
                            Next <i class="fas fa-arrow-right"></i>
                        </a>
                    {% elif show_next and not next_question %}
                        <a href="{% url 'results' subject.id %}" class="btn btn-success">
                            <i class="fas fa-flag-checkered"></i> Finish
                        </a>
                    {% else %}
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> Submit
                        </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JS -->
<script>
    // Prevent submitting without selecting an option
    document.getElementById("quizForm").addEventListener("submit", function (e) {
        let selected = document.querySelector("input[name='answer']:checked");
        if (!selected) {
            e.preventDefault();
            alert("⚠️ Please select an option before submitting.");
        }
    });

    // Hint toggle
    const hintBtn = document.getElementById("hint-btn");
    if (hintBtn) {
        hintBtn.addEventListener("click", () => {
            const hintBox = document.getElementById("hint-box");
            hintBox.style.display = hintBox.style.display === "none" ? "block" : "none";
        });
    }
</script>

<!-- Styles -->
<style>
    .option {
        border-radius: 6px;
        cursor: pointer;
        transition: all .3s ease;
    }
    .option.correct-option {
        border: 2px solid #28a745;
        background: #d4edda;
        font-weight: 600;
    }
    .option.wrong-option {
        border: 2px solid #dc3545;
        background: #f8d7da;
    }
    .hint-box {
        padding: 12px;
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        border-radius: 4px;
    }
</style>
{% endblock %}
